---
title: "第十一章 多因素试验资料的方差分析"
author: "x2yline"
date: "`r Sys.Date()`"
output:
  prettydoc::html_pretty:
    theme: tactile
    highlight: vignette
---

## 知识清单
* 1. **析因资料的方差分析**
    * 几个基本概念
    * 基本分析思路
    * R语言实现
* 2. 正交设计与方差分析
* 3. 嵌套设计资料的方差分析
* 4. 裂区设计资料的方差分析

## 1. 析因资料的方差分析
### 1.1 基本概念
> 多个因素多个水平的全面交叉分为处理组，2因素2水平是至少每一组合至少重复2次

以下表为例：  

&nbsp;| b1 | b2
--|----|----
a1| 24| 44
a2| 28 | 52

- **单独效应**(simple effect)：其他因素固定时，同一因素不同水平间的差别，如A固定在a1水平的时候B因素的单独效应为`a1b2-a1b1=20`。  
- **主效应**(main effect)：指某一因素各水平间的平均差别，如A因素的主效应为`((a2b1-a1b1)+(a2b2-a1b2))/2=(4+8)/2=6`。  
- **交互作用**(interaction)：当某因素的各个单独效应随另一个因素变化而变化时，则称这两个因素间存在交互作用。A与B的交互作用表示为AB（A是否随B的变化而变化，`AB=[(a2b2-a1b2)-(a2b1-a1b1)]/2=(8-4)=2`。

>主效应和交互作用的区别就是加减号不同

### 1.2 基本思路
> 变异分解的思路

总变异分解为**处理组间变异**和**误差**，处理组间变异继续分解为**主效应**和**交互作用**

> 交互作用通常通过处理组间变异和主效应做差求得

自由度：    
g=IJK个处理组，每组例数为n则总变异自由度为gn-1，A主效应自由度为I-1，B主效应自由度为J-1，C主效应自由度为K-1，AB的自由度为(I-1)(K-1)···，ABC的自由度为(I-1)(J-1)(K-1)，误差的自由度为为g(n-1)也等于总自由度减去其余分解出来的自由度。

### 1.3 R语言实现
与前面的[拉丁方分析](https://x2yline.github.io/statistics_note/chapter4/chapter4.html)一样【有一点不同是拉丁方没有考虑个因素直接的交互作用而使用`aov(y~a+b+c)`，考虑交互作用则用`aov(y~a*b*c)`，用aov函数按不同因素进行分解即可，如例11-3的数据：
```{r}
data1 <- haven::read_sav(
  "E:/医学统计学（第4版）/各章例题SPSS数据文件/例11-03.sav")
# x是热感觉评分，a是军装类型，b是环境，c是活动状态
# 都应该转为factor否则会默认是数值而不是分组标识
data1$a <- factor(data1$a)
data1$b <- factor(data1$b)
data1$c <- factor(data1$c)
head(data1)
summary(aov(x~a*b*c, data=data1))
```
结果与教材上的一致，结论为不同军装，不同环境和不同活动状态的主观热感觉都有差别，但尚不能认为军装与其他两个因素存在交互作用（b，c）。

## 2. 正交设计与方差分析